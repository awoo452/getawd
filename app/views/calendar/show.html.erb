<section id="task-calendar-daily">
<h1>Daily Calendar</h1>
  <%= calendar(number_of_days: 1) do |date| %>
    <ul class="task-calendar-today">
        <!-- Fetch tasks for this specific date, adjusted for timezone -->
        <% tasks_for_date = @tasks.select { |task| task.due_date.in_time_zone.to_date == date } %>

        <% tasks_for_date.each do |task| %>
          <li class="task">
            <span class="status-dot" style="background: conic-gradient(
              <% if task.actual_time.to_f > task.estimated_time.to_f %>
                red <%= ((task.actual_time.to_f / task.estimated_time.to_f) * 100).round %>%, 
                green <%= ((task.estimated_time.to_f / task.actual_time.to_f) * 100).round %>%
              <% else %>
                black <%= ((task.actual_time.to_f / task.estimated_time.to_f) * 100).round %>%, 
                green 100%
              <% end %>
            )">
            </span>
            <%= link_to (GOAL_ICONS[task.goal.category] || "📝"), task_path(task) %>
            <span class="estimated-time"><%= task.estimated_time - task.actual_time %>m</span>
          </li>
        <% end %>
    </ul>
  <% end %>
  <%= link_to 'New task', new_task_path %>
</section>

<section id="task-calendar-monthly">
<h1>Monthly Calendar</h1>
  <%= month_calendar(attribute: :due_date) do |date| %>
    <ul class="task-calendar-monthly-day">
      <strong class="date_day"><%= date.day %></strong> <!-- Shows the day number -->

      <!-- Fetch tasks for this specific date, adjusted for timezone -->
      <% tasks_for_date = @tasks.select { |task| task.due_date.in_time_zone.to_date == date } %>

      <% tasks_for_date.each do |task| %>
        <li class="task">
          <%= link_to (GOAL_ICONS[task.goal.category] || "📝"), task_path(task) %>
          <span class="estimated-time"><%= task.estimated_time - task.actual_time %>m</span>
      <% end %>
    </ul>
  <% end %>
</section>
