<section class="projects" id="projects">
  <h2 class="page-title">Projects</h2>
  <% services = @services.to_a %>
  <% service_types = services.map(&:service_type) %>
  <% projects_by_type = @projects.group_by(&:service_type) %>
  <% other_projects = @projects.select { |project| project.service_type.blank? || !service_types.include?(project.service_type) } %>

  <% services.each do |service| %>
    <% service_projects = projects_by_type[service.service_type] || [] %>
    <% next if service_projects.empty? %>
    <div class="projects-group" id="<%= service.projects_anchor %>">
      <h3 class="projects-section-title"><%= service.title %></h3>
      <%= render "project_list", projects: service_projects %>
    </div>
  <% end %>

  <% if other_projects.any? %>
    <div class="projects-group" id="other_projects">
      <h3 class="projects-section-title">Other Projects</h3>
      <%= render "project_list", projects: other_projects %>
    </div>
  <% end %>
  <%= render "shared/pagination",
        page: @projects_page,
        total_pages: @projects_total_pages,
        path_helper: :projects_path %>
</section>
